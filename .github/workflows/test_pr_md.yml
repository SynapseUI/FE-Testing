on: push
# on: pull_request

jobs:
  format-pr-comment:
    runs-on: ubuntu-latest
    env:
      NODE_OPTIONS: '--max_old_space_size=4096'
    steps:
      - run: mkdir repo
      - name: Checkout code into repo dir
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          path: repo

      - run: npm --prefix repo install
      - run: mkdir dev_scripts



      - name: Check out dev_scripts
        uses: actions/checkout@v2
        with:
          repository: SynapseUI/dev_scripts
          token: "${{ secrets.TEST_PAT }}"
          path: 'dev_scripts'

      - name: Run devscripts
        run: |
          node \
          dev_scripts/scripts/makePrMarkdown.js \
          --repo-dir=repo \
          test-branch master

      - name: show new file
        run: ls -l repo/prMarkdown

      - run: echo ${{ github.head_ref }}
      - run: echo ${{ github.base_ref }}

      # - id: get-comment-body
      #   run: |
      #     body="$(cat repo/.prMarkdown)"
      #     body="${body//'%'/'%25'}"
      #     body="${body//$'\n'/'%0A'}"
      #     body="${body//$'\r'/'%0D'}" 
      #     echo "::set-output name=body::$body"

      # - name: Create comment
      #   uses: peter-evans/create-or-update-comment@v2
      #   with:
      #     issue-number: 1
      #     body: ${{ steps.get-comment-body.outputs.body }}
